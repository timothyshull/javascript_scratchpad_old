<!DOCTYPE html>  <html> <head>   <title>aura.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               aura.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Core</h2>

<p>Implements the mediator pattern and
encapsulates the core functionality for this application.
Based on the work by Addy Osmani and Nicholas Zakas.</p>

<ul>
<li><a href="http://addyosmani.com/largescalejavascript/">Patterns For Large-Scale JavaScript Application Architecture</a></li>
<li><a href="http://speakerdeck.com/u/addyosmani/p/large-scale-javascript-application-architecture">Large-scale JavaScript Application Architecture Slides</a></li>
<li><a href="http://addyosmani.com/blog/large-scale-jquery/">Building Large-Scale jQuery Applications</a></li>
<li><a href="http://www.youtube.com/watch?v=vXjVFPosQHw&amp;feature=youtube_gdata_player">Nicholas Zakas: Scalable JavaScript Application Architecture</a></li>
<li><a href="http://net.tutsplus.com/tutorials/javascript-ajax/writing-modular-javascript-new-premium-tutorial/">Writing Modular JavaScript: New Premium Tutorial</a></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*jslint nomen:true, sloppy:true, browser:true*/</span>
<span class="cm">/*global define, require, _*/</span>
<span class="nx">define</span><span class="p">(</span><span class="s1">&#39;aura_core&#39;</span><span class="p">,[</span><span class="s1">&#39;jquery&#39;</span><span class="p">,</span> <span class="s1">&#39;underscore&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">channels</span> <span class="o">=</span> <span class="p">{},</span>  <span class="c1">// Loaded modules and their callbacks</span>
        <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>       <span class="c1">// Mediator object</span>

    </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Override the default error handling for requirejs</p>

<p>TODO: Replace this with the new errbacks</p>

<ul>
<li><a href="http://requirejs.org/docs/api.html#errors">Handling Errors</a></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">requirejs</span><span class="p">.</span><span class="nx">onError</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">requireType</span> <span class="o">===</span> <span class="s1">&#39;timeout&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;Could not load module &#39;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">.</span><span class="nx">requireModules</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>If a timeout hasn't occurred and there was another module 
related error, unload the module then throw an error</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">failedId</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">requireModules</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span><span class="p">.</span><span class="nx">requireModules</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="nx">requirejs</span><span class="p">.</span><span class="nx">undef</span><span class="p">(</span><span class="nx">failedId</span><span class="p">);</span>

            <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>


    </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Subscribe to an event</p>

<ul>
<li><strong>param:</strong> {string} channel Event name</li>
<li><strong>param:</strong> {object} callback Module callback</li>
<li><strong>param:</strong> {object} context Context in which to execute the module</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">obj</span><span class="p">.</span><span class="nx">subscribe</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">])</span> <span class="o">?</span> <span class="p">[]</span> <span class="o">:</span> <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">];</span>
        <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">method</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">));</span>
    <span class="p">};</span>

    </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Publish an event, passing arguments to subscribers. Will
call start if the channel is not already registered.</p>

<ul>
<li><strong>param:</strong> {string} channel Event name</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">obj</span><span class="p">.</span><span class="nx">publish</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">obj</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Automatically load a widget and initialize it. File name of the
widget will be derived from the channel, decamelized and underscore
delimited by default.</p>

<ul>
<li><strong>param:</strong> {string} channel Event name</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">obj</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">channel</span><span class="p">){</span>

        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="nx">file</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">decamelize</span><span class="p">(</span><span class="nx">channel</span><span class="p">);</span>
        </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>If a widget hasn't called subscribe this will fail because it wont
be present in the channels object</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">require</span><span class="p">([</span><span class="s2">&quot;widgets/&quot;</span> <span class="o">+</span> <span class="nx">file</span> <span class="o">+</span> <span class="s2">&quot;/main&quot;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">};</span>


    </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Unload a widget (collection of modules) by passing in a named reference
to the channel/widget. This will both locate and reset the internal
state of the modules in require.js and empty the widgets DOM element</p>

<ul>
<li><strong>param:</strong> {string} channel Event name</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">obj</span><span class="p">.</span><span class="nx">stop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channel</span><span class="p">){</span>

        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="nx">el</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">file</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">decamelize</span><span class="p">(</span><span class="nx">channel</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Remove all modules under a widget path (e.g widgets/todos)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">obj</span><span class="p">.</span><span class="nx">unload</span><span class="p">(</span><span class="s2">&quot;widgets/&quot;</span> <span class="o">+</span> <span class="nx">file</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Empty markup associated with the module</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

    <span class="p">};</span>

    </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Undefine/unload a module, resetting the internal state of it in require.js
to act like it wasn't loaded. By default require won't cleanup any markup
associated with this</p>

<p>The interesting challenge with .stop() is that in order to correctly clean-up
one would need to maintain a custom track of dependencies loaded for each 
possible channel, including that channels DOM elements per depdendency. </p>

<p>This issue with this is shared dependencies. E.g, say one loaded up a module
containing jQuery, others also use jQuery and then the module was unloaded.
This would cause jQuery to also be unloaded if the entire tree was being done
so.</p>

<p>A simpler solution is to just remove those modules that fall under the
widget path as we know those dependencies (e.g models, views etc) should only
belong to one part of the codebase and shouldn't be depended on by others.</p>

<ul>
<li><strong>param:</strong> {string} channel Event name</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">obj</span><span class="p">.</span><span class="nx">unload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channel</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">contextMap</span> <span class="o">=</span> <span class="nx">requirejs</span><span class="p">.</span><span class="nx">s</span><span class="p">.</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">_</span><span class="p">.</span><span class="nx">urlMap</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">contextMap</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">contextMap</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">key</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">require</span><span class="p">.</span><span class="nx">undef</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">};</span>


    <span class="nx">obj</span><span class="p">.</span><span class="nx">util</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">each</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">,</span>
        <span class="nx">extend</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">,</span>
        <span class="nx">decamelize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">camelCase</span><span class="p">,</span> <span class="nx">delimiter</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">delimiter</span> <span class="o">=</span> <span class="p">(</span><span class="nx">delimiter</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;_&quot;</span> <span class="o">:</span> <span class="nx">delimiter</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">camelCase</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([A-Z])/g</span><span class="p">,</span> <span class="nx">delimiter</span> <span class="o">+</span> <span class="s1">&#39;$1&#39;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
        <span class="p">},</span>
        </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Camelize a string</p>

<ul>
<li><p><a href="camelize.js">https://gist.github.com/827679</a></p></li>
<li><p><strong>param:</strong> {string} str String to make camelCase</p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">camelize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(?:^|[\-_])(\w)/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">delimiter</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">c</span> <span class="o">?</span> <span class="nx">c</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="p">});</span>
        <span class="p">},</span>
        </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Always returns the fn within the context</p>

<ul>
<li><strong>param:</strong> {object} fn Method to call</li>
<li><strong>param:</strong> {object} context Context in which to call method</li>
<li><strong>returns:</strong> {object} Fn with the correct context</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">method</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">parseJson</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
        <span class="p">},</span>
        </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Get the rest of the elements from an index in an array</p>

<ul>
<li><strong>param:</strong> {array} arr The array or arguments object</li>
<li><strong>param:</strong> {integer} [index=0] The index at which to start</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">rest</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">delay</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">delay</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">obj</span><span class="p">.</span><span class="nx">dom</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">find</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span> <span class="o">||</span> <span class="nb">document</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">context</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">data</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">attribute</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">attribute</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">obj</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">listen</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">events</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">context</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">bindAll</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">obj</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">parse</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Placeholder for things like ajax and local storage</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">obj</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span>
    <span class="p">};</span>

    <span class="nx">obj</span><span class="p">.</span><span class="nx">_getChannels</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">channels</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>

<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h2>Permissions</h2>

<p>A permissions structure can support checking
against subscriptions prior to allowing them
to clear. This enforces a flexible security
layer for your application.</p>

<pre><code>{eventName: {moduleName:[true|false]}, ...}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;aura_perms&#39;</span><span class="p">,[</span><span class="s2">&quot;jquery&quot;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	
	<span class="kd">var</span> <span class="nx">permissions</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">rules</span> <span class="o">=</span> <span class="p">{};</span>  
    
    <span class="nx">permissions</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">extended</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">aura</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">aura</span><span class="p">.</span><span class="nx">permissions</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">rules</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">extended</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">aura</span><span class="p">.</span><span class="nx">permissions</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">rules</span> <span class="o">=</span> <span class="nx">extended</span><span class="p">;</span>
        <span class="p">}</span>
        
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <ul>
<li><strong>param:</strong> {string} subscriber Module name</li>
<li><strong>param:</strong> {string} channel Event name</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">permissions</span><span class="p">.</span><span class="nx">validate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">subscriber</span><span class="p">,</span> <span class="nx">channel</span><span class="p">){</span>
		<span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">rules</span><span class="p">[</span><span class="nx">channel</span><span class="p">][</span><span class="nx">subscriber</span><span class="p">];</span>
		<span class="k">return</span> <span class="nx">test</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="nx">test</span><span class="p">;</span>
	<span class="p">};</span>

	<span class="k">return</span> <span class="nx">permissions</span><span class="p">;</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h2>Sandbox</h2>

<p>Set up an standard interface for modules. This is a
subset of the mediator functionality.</p>

<p>Note: Handling permissions/security is optional here
The permissions check can be removed
to just use the mediator directly.</p>             </td>             <td class="code">               <div class="highlight"><pre> 
<span class="cm">/*global define*/</span>
<span class="nx">define</span><span class="p">(</span><span class="s1">&#39;facade&#39;</span><span class="p">,[</span><span class="s2">&quot;aura_core&quot;</span><span class="p">,</span> <span class="s2">&quot;aura_perms&quot;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mediator</span><span class="p">,</span> <span class="nx">permissions</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">facade</span> <span class="o">=</span> <span class="p">{};</span>


    </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <ul>
<li><strong>param:</strong> {string} subscriber Module name</li>
<li><strong>param:</strong> {string} channel Event name</li>
<li><strong>param:</strong> {object} callback Module</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">facade</span><span class="p">.</span><span class="nx">subscribe</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subscriber</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">permissions</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">subscriber</span><span class="p">,</span> <span class="nx">channel</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">mediator</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <ul>
<li><strong>param:</strong> {string} channel Event name</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">facade</span><span class="p">.</span><span class="nx">publish</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mediator</span><span class="p">.</span><span class="nx">publish</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">mediator</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>


    </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <ul>
<li><strong>param:</strong> {string} channel Event name</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">facade</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channel</span><span class="p">){</span>
        <span class="nx">mediator</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">mediator</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>

    </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <ul>
<li><strong>param:</strong> {string} channel Event name</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">facade</span><span class="p">.</span><span class="nx">stop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channel</span><span class="p">){</span>
        <span class="nx">mediator</span><span class="p">.</span><span class="nx">stop</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">mediator</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>



    <span class="nx">facade</span><span class="p">.</span><span class="nx">dom</span> <span class="o">=</span> <span class="p">{</span>
        </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <ul>
<li><strong>param:</strong> {string} selector CSS selector for the element</li>
<li><strong>param:</strong> {string} context CSS selector for the context in which 
to search for selector</li>
<li><strong>returns:</strong> {object} Found elements or empty array</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">find</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">mediator</span><span class="p">.</span><span class="nx">dom</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">facade</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="p">{</span>
        </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <ul>
<li><strong>param:</strong> {object} context Element to listen on</li>
<li><strong>param:</strong> {string} events Events to trigger, e.g. click, focus, etc.</li>
<li><strong>param:</strong> {string} selector Items to listen for</li>
<li><strong>param:</strong> {object} data</li>
<li><strong>param:</strong> {object} callback</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">listen</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">events</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">mediator</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">events</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">bindAll</span><span class="o">:</span> <span class="nx">mediator</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">bindAll</span>
    <span class="p">};</span>

    <span class="nx">facade</span><span class="p">.</span><span class="nx">util</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">each</span><span class="o">:</span> <span class="nx">mediator</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">each</span><span class="p">,</span>
        <span class="nx">rest</span><span class="o">:</span> <span class="nx">mediator</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">rest</span><span class="p">,</span>
        <span class="nx">delay</span><span class="o">:</span> <span class="nx">mediator</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">delay</span><span class="p">,</span>
        <span class="nx">extend</span><span class="o">:</span> <span class="nx">mediator</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">extend</span>
    <span class="p">};</span>

    <span class="nx">facade</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">mediator</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
    <span class="nx">facade</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">mediator</span><span class="p">.</span><span class="nx">template</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">facade</span><span class="p">;</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 